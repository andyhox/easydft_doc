# 18. 老花眼选手怎么建缺陷结构——取代&空位模型

做计算的免不了跟结构打交道，老司机每次建模感觉散光都加重了，看到球棍模型就眼花。

今天简单分享下，怎么用`pymatgen`​搭建点缺陷(`Point Defect`​) 模型。

主要用到`pymatgen.analysis.defects`​包，该包不包含在`pymatgen`​里面，需要额外安装。在`pymatgen`​所在环境下直接`pip`​安装即可：

```shell
pip install pymatgen-analysis-defects
```

还是以`Mn3O4`​为例，结构见上一篇内容。

### 单原子取代

```python
from pymatgen.analysis.defects.generators import SubstitutionGenerator, VacancyGenerator
from pymatgen.core import Structure

# 读取结构
struct = Structure.from_file('/Mn3O4.vasp')

sg = SubstitutionGenerator()
# Fe替换Mn
sub_structs = sg.generate(struct, substitution= {'Mn':'Fe'})

for i, sub_struct in enumerate(sub_structs):
    print(sub_struct.defect_structure)
```

会输出替换后的结构：

```text
Full Formula (Mn11 Fe1 O16)
Reduced Formula: Mn11FeO16
abc   :  11.023800   5.742800   5.751500
angles:  90.000000 121.327599  90.000000
pbc   :       True       True       True
Sites (28)
  #  SP             a       b        c
---  -------  -------  ------  -------
  0  Fe       0.87411  0.5     0.6231
  1  Mn2.67+  0.12589  0.5     0.3769
  2  Mn2.67+  0.37411  0       0.6231
  3  Mn2.67+  0.62589  0       0.3769
  4  Mn2.67+  0        0       0
  5  Mn2.67+  0.75     0.25    0
  6  Mn2.67+  0.75     0.75    0
  7  Mn2.67+  0        0       0.5
  8  Mn2.67+  0.5      0.5     0
  9  Mn2.67+  0.25     0.75    0
 10  Mn2.67+  0.25     0.25    0
 11  Mn2.67+  0.5      0.5     0.5
 12  O2-      0.00699  0.7762  0.75597
 13  O2-      0.24188  0       0.2137
 14  O2-      0.75722  0       0.23178
 15  O2-      0.75812  0       0.7863
 16  O2-      0.99301  0.7762  0.24403
 17  O2-      0.99301  0.2238  0.24403
 18  O2-      0.00699  0.2238  0.75597
 19  O2-      0.24278  0       0.76822
......
......
```

根据以下代码可以保存掺杂替换的结构：

```python
for i, sub_struct in enumerate(sub_structs):
    sub_struct.defect_structure.to(filename=f'/sub_{i}.cif', fmt='cif')
```

此时会在当前目录生成`sub_0.cif`​、`sub_1.cif`​、`sub_2.cif`​、`sub_3.cif`​四个结构。

**重点来了！！！！**

细心的可以发现，惯用包`Mn3O4`​结构里面总原子个数`Mn12O16`​，最终只给出了四个结构。因为`SubstitutionGenerator()`​在生成替换结构时会自动进行`StructureMatch`​，来剔除掉重复的对称性结构。

因此在实际应用中可以极大的简化人为操作：例如我们在研究掺杂样品时，首先需要找到掺杂结构的基态结构，然后进行后续的性质计算。调用`SubstitutionGenerator()`​后可自动输出所有不重复的掺杂结构，然后直接调用`MPRelaxSet`​生成计算输入进行`VASP`​计算。全程无需在`VESTA`​等软件里面自己一个个的去进行位点替换，极大的保护我们的眼睛~~~~

### 空位结构

代码结构与上面的单原子掺杂类似，不多解释，直接上代码：

```python
from pymatgen.analysis.defects.generators import VacancyGenerator
from pymatgen.core import Structure

struct = Structure.from_file('/Mn3O4.vasp')

vg = VacancyGenerator()

vac_structs = vg.generate(struct, rm_species=['O'])
for i, vac_struct in enumerate(vac_structs):
    print(vac_struct.defect_structure)
```

输出结构：

```text
Full Formula (Mn12 O15)
Reduced Formula: Mn4O5
abc   :  11.023800   5.742800   5.751500
angles:  90.000000 121.327599  90.000000
pbc   :       True       True       True
Sites (27)
  #  SP             a       b        c
---  -------  -------  ------  -------
  0  Mn2.67+  0.87411  0.5     0.6231
  1  Mn2.67+  0.12589  0.5     0.3769
  2  Mn2.67+  0.37411  0       0.6231
  3  Mn2.67+  0.62589  0       0.3769
  4  Mn2.67+  0        0       0
  5  Mn2.67+  0.75     0.25    0
  6  Mn2.67+  0.75     0.75    0
  7  Mn2.67+  0        0       0.5
  8  Mn2.67+  0.5      0.5     0
  9  Mn2.67+  0.25     0.75    0
 10  Mn2.67+  0.25     0.25    0
 11  Mn2.67+  0.5      0.5     0.5
 12  O2-      0.24188  0       0.2137
 13  O2-      0.75722  0       0.23178
 14  O2-      0.75812  0       0.7863
 15  O2-      0.99301  0.7762  0.24403
 16  O2-      0.99301  0.2238  0.24403
 17  O2-      0.00699  0.2238  0.75597
 18  O2-      0.24278  0       0.76822
 19  O2-      0.50699  0.2762  0.75597
......
......
```

最终只输出了`3`​个含单个氧空位的结构。

---

代码也很简单，多多练习QAQ

‍
